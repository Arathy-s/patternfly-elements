@import "shared-assets";

/// ===========================================================================
/// ACCORDION HEADER
/// ===========================================================================
:host {
  @include pfe-hidden;
  @include pfe-box-sizing;
  
  position: relative;
  display: block;
  margin-bottom: -1px;

  --pfe-icon--color: #{pfe-local(Color)};
}

// Remove margins from the heading
#heading {
  margin: 0;
}

.pf-c-accordion__toggle {
  position: relative;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: calc(#{pfe-var(container-padding)} * 1.5); // 24px
  cursor: pointer;

  width: 100%;
  padding: pfe-local(Padding);

  font-family: inherit;
  // font-family: var(--pf-c-accordion__toggle--FontFamily, inherit);
  font-size: pfe-local(FontSize--header);
  // font-size: var(--pf-c-accordion__toggle--FontSize, inherit);
  font-weight: pfe-var(font-weight--bold);
  text-align: pfe-local(TextAlign);
  line-height: pfe-var(line-height);

  background-color: pfe-local(BackgroundColor);
  color: pfe-local(Color);

  @include browser-query(ie11) {
    padding: 16px 24px;
    background-color: pfe-fetch(surface--lightest) !important;
    color: pfe-fetch(text) !important;
  }

  border: pfe-local(BorderWidth) pfe-var(surface--border-style) pfe-local(BorderColor);
  border-right-color: transparent;
  border-left-color: transparent;

  &:focus,
  &:focus-visible {
    outline: none;
  }

  // Keyboard focus state; cannot use outline because of border overlays
  &::before {
    position: absolute;
    top: -2px;
    left: -2px;
    width: calc(100% + 4px);
    height: calc(100% + 4px);
    content: "";
    background-color: transparent;
    z-index: calc(#{pfe-local(ZIndex)} + 3);
  }

  &::after {
    position: absolute;
    top: -1px;
    bottom: -1px;
    left: -1px;
    width: pfe-local(accent--width);
    height: calc(100% + 2px);
    content: "";
    background-color: transparent;
    z-index: calc(#{pfe-local(ZIndex)} + 1);
  }

  &:focus-visible::before {
    border: pfe-var(ui--border-width--md) pfe-var(ui--border-style) pfe-broadcasted(link--focus);
    border-color: #6b9ff0;
    border-radius: pfe-var(ui--border-radius);
  }

  &:hover,
  :host(:not([expanded])) &:focus,
  &:active {
    --pfe-accordion--BackgroundColor: #{pfe-local(BackgroundColor--active)};
    --pfe-accordion--Color: #{pfe-local(Color--active, inherit)};
  }

  &:hover::after
  &:active::after {
    background-color: pfe-local(accent);
  }
}

.pf-c-accordion__toggle-icon {
  transition: transform 0.2s pfe-var(animation-timing);
}

.pf-c-accordion__toggle-text {
  max-width: pfe-local(MaxWidth--content);
}

slot {
  display: block;
  flex-grow: 1;
}

:host([expanded]),
:host(.animating) {
  --pfe-accordion--BackgroundColor: #{pfe-local(BackgroundColor--expanded)};
  --pfe-accordion--Color:           #{pfe-local(Color--expanded)};

  box-shadow: pfe-local(BoxShadow);

  .pf-c-accordion__toggle {
    border-right-color: pfe-local(BorderColor);
    border-left-color: pfe-local(BorderColor);
  }

  .pf-c-accordion__toggle::after {
    background-color: pfe-local(accent--expanded);
  }

  .pf-c-accordion__toggle-icon {
    transform: rotate(90deg);
  }
}

/// ===========================================================================
/// DISCLOSURE STYLES
/// ===========================================================================
:host([disclosure="true"]) {
  .pf-c-accordion__toggle {
    border-left-width: pfe-local(BorderWidth);
    border-right-color: pfe-local(BorderColor);
    border-left-color: pfe-local(BorderColor);

    &:hover {
      border-left-width: pfe-local(BorderWidth);
      border-left-color: pfe-local(BorderColor);
      border-right-color: pfe-local(BorderColor);
    }
  }

  .pf-c-accordion__toggle-icon {
    order: -1;
  }
}

:host([disclosure="true"][expanded]),
:host([disclosure="true"].animating) {
  .pf-c-accordion__toggle {
    border-left-width: pfe-local(BorderWidth);
    border-left-color: pfe-local(BorderColor);
    border-right-color: pfe-local(BorderColor);
  }
}

/// ===========================================================================
/// CONTEXT FOR EXPANDED
/// ===========================================================================
:host(:not([on="light"])) {
  --pfe-accordion--BoxShadow: "none";
}

:host([on="dark"]) .pf-c-accordion__toggle::after:hover,
:host([is-navigation][on="dark"]:focus) .pf-c-accordion__toggle::after {
  background-color:  pfe-local(accent, pfe-var(ui-accent--on-dark));
}

:host([on="dark"][expanded]),
:host([on="dark"].animating) {
  --pfe-accordion--BackgroundColor: #{pfe-local(BackgroundColor--expanded, rgba(247, 247, 249, .1))};
  --pfe-accordion--Color:           #{pfe-local(Color--expanded, pfe-broadcasted(text--on-dark))};
  --pfe-accordion--accent:          #{pfe-local(accent--expanded, pfe-var(ui-accent--on-dark))};
}

:host([on="dark"]) .pf-c-accordion__toggle:hover,
:host([on="dark"]) .pf-c-accordion__toggle:focus,
:host([on="dark"]) .pf-c-accordion__toggle:active {
  --pfe-accordion--BackgroundColor: #{pfe-local(BackgroundColor--active, rgba(247, 247, 249, .1))};
  --pfe-accordion--Color: #{pfe-local(Color--active, inherit)};
}

:host([on="saturated"]) .pf-c-accordion__toggle::after:hover,
:host([is-navigation][on="saturated"]:focus) .pf-c-accordion__toggle::after {
  background-color:  pfe-local(accent, pfe-var(ui-accent--on-saturated));
}

:host([on="saturated"][expanded]),
:host([on="saturated"].animating) {
  --pfe-accordion--BackgroundColor: #{pfe-local(BackgroundColor--expanded, rgba(0, 0, 0, .2))};
  --pfe-accordion--Color:           #{pfe-local(Color--expanded, pfe-broadcasted(text--on-saturated))};
  --pfe-accordion--accent:          #{pfe-local(accent--expanded, pfe-var(ui-accent--on-saturated))};
}

:host([on="saturated"]) .pf-c-accordion__toggle:hover,
:host([on="saturated"]) .pf-c-accordion__toggle:focus,
:host([on="saturated"]) .pf-c-accordion__toggle:active {
  --pfe-accordion--BackgroundColor: #{pfe-local(BackgroundColor--active, rgba(0, 0, 0, .2))};
  --pfe-accordion--Color: #{pfe-local(Color--active, inherit)};
}
