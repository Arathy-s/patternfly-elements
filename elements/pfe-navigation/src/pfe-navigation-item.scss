@import "_shared-assets";

:host {
  display: flex;
  flex-direction: column;
  line-height: 1.2;

  height: 100%;
  min-width: pfe-local(MinWidth);

  @media screen and (max-width: pfe-breakpoint(xl)) {
    width: 100%;
  }
}

/* ----------------- */
/*  VARIANTS         */
/* ----------------- */

// The wind variant is used to render an icon with text inline, direct links
:host([variant="wind"]) {
  .pfe-navigation-item__trigger {
    padding:  pfe-local(Padding, $region: trigger, $fallback: calc(#{pfe-var(container-padding)} / 2) 0 calc(#{pfe-var(container-padding)} / 2) calc(#{pfe-var(container-spacer)} * 1.5));
    color:    pfe-var(link);
    background-color: transparent;

    flex-direction: row;
    align-items: stretch;
    justify-content: flex-start;

    border: none;

    &:hover {
      color: pfe-var(link--hover);
    }
    &:focus {
      color: pfe-var(link--focus);
    }
  }
  .pfe-navigation-item__tray {
    --pfe-icon--Color: #{pfe-var(link)};

    margin-bottom: 0;
    margin-right: calc(#{pfe-var(container-spacer)} / 2);
  }
}

//-- Let the main item or the tray be hidden with the hidden attribute
:host([hidden]:not([show_tray])) {
  @extend %hidden;
}

:host([show_tray]),
:host([show_links]) ::slotted([slot="tray"][hidden]) {
  display: flex;
  visibility: visible;
  flex-grow: 1;
}

:host([pfe-icon="web-mobile-menu"]) {
  align-items: flex-end;
  flex-grow: 0;
  flex-shrink: 1;
  flex-basis: 99%;
}

// Indicates this is the current section the user is visiting
:host([aria-current="location"]) {
  --pfe-navigation--BorderTopColor: #{pfe-local(accent)};
}

// Mobile menu experience
:host([is_nested]:not([parent_hidden])) {
  display: flex;
  margin: 0 auto;
  align-items: center;
  max-width: pfe-local(Width);
}

// @TODO set up tray opening animation?
// :host(.animating) {
//   transition: transform 0.3s #{pfe-var(animation-timing)};
// }

/* ----------------- */
/*  TRIGGER STYLES   */
/* ----------------- */
.pfe-navigation-item__trigger {
  border-top:         pfe-var(surface--border-width--heavy) pfe-var(surface--border-style) pfe-local(BorderTopColor);
  border-right:       pfe-var(surface--border-width) dashed pfe-local(BorderColor);
  border-bottom:      pfe-var(surface--border-width) dashed pfe-local(BorderColor);
  border-left:        pfe-var(surface--border-width) dashed pfe-local(BorderColor);

  background-color:   pfe-local(BackgroundColor, $region: trigger);
  color:              pfe-local(Color, $region: trigger);

  padding:            pfe-local(Padding, $region: trigger);

  position:           relative;
  display:            flex;
  flex-grow:          1;
  flex-direction:     column;
  flex-wrap:          nowrap;
  align-items:        center;
  justify-content:    center;

  transition:         background-color pfe-var(animation-timing) pfe-var(animation-speed), border pfe-var(animation-timing) pfe-var(animation-speed);

  outline:            none;
  cursor:             pointer;

  font-family:  pfe-var(font-family);
  font-size:    pfe-local(FontSize, $region: trigger);
  font-weight:  pfe-local(FontWeight, $region: trigger);

  z-index: 2;
  line-height: 1.1;
  margin: 0;
  max-width: pfe-local(MaxWidth, $region: trigger);
  text-align: center;

  @media screen and (min-width: pfe-breakpoint(sm-mobile, $map: false)) {
    padding: pfe-local(Padding, $region: trigger, $fallback: pfe-var(container-padding));
  }

  @media screen and (min-width: pfe-breakpoint(xl) ) {
      max-width: pfe-local(MaxWidth, $region: trigger, $fallback: 190px);
  }

  :host(.expanded) &,
  &:hover,
  &:focus {
    border-top-color: pfe-local(accent);
  }

  :host(.expanded) &,
  &:focus {
    border-right-color:   pfe-var(surface--lightest);
    border-bottom-color:  pfe-var(surface--lightest);
    border-left-color:    pfe-var(surface--lightest);
  }


  // After element is the filled-in dropdown caret
  &::after {
    display: block;
    content: " ";
    visibility: hidden;

    @include pfe-arrow(down, pfe-var(feedback--default), $width: 6px, $height: 6px);
    position: absolute;
    bottom: calc(#{pfe-var(container-spacer)} / 2);

    //-- Chevron styles for the navigation accordion on mobile
    :host([is_nested]:not([parent_hidden])) & {
      visibility: visible;
      border-color: pfe-local(Color, $region: trigger);
    }
    // closed:
    :host([is_nested]:not(.expanded):not([parent_hidden])) & {
      @include pfe-chevron($state: closed, $offset: 0px);
    }
    // open:
    :host([is_nested].expanded:not([parent_hidden])) & {
      @include pfe-chevron($state: open, $offset: 4px);
    }
    :host([is_nested]:not([has_tray]):not([parent_hidden])) & {
      transform: rotate(-45deg);
    }
  }
    
  :host([has_tray].expanded:not([pfe-icon])) &::after,
  :host([has_tray]:not([pfe-icon])) &:hover::after {
    visibility: visible;
  }

  // When the navigation item is expanded
  :host(.expanded) & {
    background-color: pfe-var(surface--lightest);
    color:            pfe-var(text);
  }

  :host([show_links]) > &,
  :host([hidden]) & {
    @extend %hidden;
  }

  // At mobile if inside the main context, update the color to a text color
  :host([is_nested]:not([parent_hidden],[desktop])) & {
    $accordion: pfe-accordion-variables;
    @include pfe-print-local($accordion);
    @include pfe-trigger;

    box-sizing: border-box;
    align-items: stretch;

    background-color: pfe-var(surface--lightest);
    color: pfe-var(text);
  }

  :host([is_nested].expanded:not([parent_hidden])) & {
    $accordion: pfe-accordion-variables($state: expanded);
    @include pfe-print-local($accordion);
  }

  :host([is_nested][last]:not(.expanded):not([parent_hidden])) & {
    @include pfe-trigger-last;
  }

  &--icon {
    --pfe-icon--Color: #{pfe-var(text--on-dark)};

    &[icon="web-plus"] {
      transform: rotate(-45deg);
    }
    :host(.expanded) & {
      --pfe-icon--Color: #{pfe-var(text)};
    }
  }

  &--label {
    color: inherit;
    text-decoration: none;
  }
}
// -- end trigger styles

/* ----------------- */
/*    TRAY STYLES    */
/* ----------------- */
.pfe-navigation-item__tray {
  --pfe-navigation--FontWeight: #{pfe-var(text)};

  @include pfe-set-broadcast-theme(light);

  transition: all pfe-var(animation-timing);
  box-sizing: border-box;

  @extend %hidden;

  &[aria-expanded="true"] {
    display: block;
    visibility: visible;
  }

  :host([show_links]:not([parent_hidden])) & {
    flex-grow: 1;
    display: flex;
    visibility: visible;
    width: 100%;
    padding-right: 40px; // ensure gap between main menu links and utility links
  }

  :host([pfe-icon="web-mobile-menu"]:not([show_links])) &,
  :host(:not([pfe-icon="web-mobile-menu"]):not([is_nested])) &,
  :host([is_nested][parent_hidden]) & {
    position: absolute;
    top: 100%;
    left: 0;

    background-color: pfe-local(BackgroundColor, $region: tray);
    color:            pfe-local(Color, $region: tray);
    // mobile tray padding
    padding: pfe-local(Padding, $region: tray);
    width: 100%;
    max-height: calc(100vh - #{pfe-local(Height)});
    overflow-x: hidden;
    overflow-y: scroll;
    padding-right: 9px; // OFFSET SCROLLBAR HACK
  }

  //  Styles for the nested elements
  :host([is_nested]:not([parent_hidden])) & {
    @include pfe-collapsible($state: closed);
    @include pfe-accordion-props;
    @include pfe-box-sizing;
    @include pfe-panel-container;
    // mobile tray padding
    padding: calc(#{pfe-local(Padding--vertical)} / 2)  calc(#{pfe-local(Padding--horizontal)} * 1.75);
  }

  :host([is_nested].expanded:not([parent_hidden])) & {
    $accordion: pfe-accordion-variables($state: expanded);
    @include pfe-print-local($accordion);
    @include pfe-panel-variables;
    @include pfe-collapsible($state: open);
  }
  :host([is_nested][parent_hidden][pfe-full-width]) & {
    padding: pfe-local(Padding, $region: tray) 0 pfe-local(Padding, $region: tray);
  }

  :host([hidden]) &,
  :host(:not(.expanded):not([show_links])) & {
    @extend %hidden;
  }
}

::slotted([slot="tray"]) {
  display: flex;
  justify-content: center;
}

// If the navigation item has an icon, i.e. a utility link
:host([pfe-icon]) {
  flex-basis: auto;
  min-width: pfe-local(MinWidth, $fallback: 65px);

  // when utilities are shown in the black bar
  @media screen and (min-width: pfe-fetch(lg-mobile)) {
    width: 70px;
  }
  .pfe-navigation-item__trigger {
    width: max-content;
    padding: pfe-local(Padding, $region: trigger, $fallback: calc(#{pfe-var(container-padding)} * .625));

    @media screen and (max-height: pfe-fetch(sm-mobile)) {
      padding: pfe-local(Padding, $region: trigger, $fallback: calc(#{pfe-var(container-padding)} / 3) calc(#{pfe-var(container-padding)} *.5));
    }
    &--label {
      margin: 0.25em 0 0 0 !important;
      max-width: 100px;
      // font-size: pfe-local(FontSize, $region: trigger, $fallback: 12px);
      font-size: 12px;
    }
  }
}
